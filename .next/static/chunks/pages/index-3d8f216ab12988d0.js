(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{2936:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(8749)}])},8749:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>h});var r=a(7876),n=a(4232);let s=e=>{let{children:t,onClick:a,className:n=""}=e;return(0,r.jsx)("button",{onClick:a,className:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 transition ".concat(n),children:t})};var c=a(4799),l=a(1416),i=a(3555),o=a(9083),d=a(294),u=a(1334),x=a(753);let m=(0,a(2692).Ay)("http://localhost:5000");function h(){let[e,t]=(0,n.useState)(!0),[a,h]=(0,n.useState)(!0),[f,p]=(0,n.useState)(!1),[g,j]=(0,n.useState)(!1),[w,b]=(0,n.useState)({age:!1,terms:!1}),[v,N]=(0,n.useState)(!1),[k,C]=(0,n.useState)(""),y=(0,n.useRef)(null),R=(0,n.useRef)(null),S=(0,n.useRef)(null),O=(0,n.useRef)(null),E=(0,n.useRef)([]),_=async()=>{let e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});y.current&&(y.current.srcObject=e),S.current=new RTCPeerConnection,e.getTracks().forEach(t=>{S.current.addTrack(t,e)}),S.current.ontrack=e=>{R.current&&(R.current.srcObject=e.streams[0])},S.current.onicecandidate=e=>{e.candidate&&m.emit("signal",{to:T,data:{candidate:e.candidate}})}},A=()=>{var e;j(!1),null==(e=S.current)||e.close(),S.current=null},[T,P]=(0,n.useState)(null);return(0,n.useEffect)(()=>(m.on("partner-found",async e=>{let{partnerId:t}=e;j(!0),P(t),await _();let a=await S.current.createOffer();await S.current.setLocalDescription(a),m.emit("signal",{to:t,data:{offer:a}})}),m.on("signal",async e=>{let{from:t,data:a}=e;if(a.offer){await S.current.setRemoteDescription(new RTCSessionDescription(a.offer));let e=await S.current.createAnswer();await S.current.setLocalDescription(e),m.emit("signal",{to:t,data:{answer:e}})}else if(a.answer)await S.current.setRemoteDescription(new RTCSessionDescription(a.answer));else if(a.candidate)try{await S.current.addIceCandidate(new RTCIceCandidate(a.candidate))}catch(e){console.error("Error adding received ice candidate",e)}}),m.on("partner-left",()=>{alert("Your partner has left the chat."),A()}),()=>{m.off("partner-found"),m.off("signal"),m.off("partner-left")}),[]),(0,r.jsxs)("div",{className:"min-h-screen bg-neutral-900 text-white flex flex-col items-center justify-center p-4",children:[(0,r.jsx)("h1",{className:"text-4xl font-extrabold mb-4",children:"Welcome to EchoMeet"}),(0,r.jsx)("p",{className:"text-neutral-400 mb-6 max-w-xl text-center",children:"A safe, anonymous space to meet new people and connect through video chat. Please confirm your age to begin."}),!g&&(0,r.jsxs)("div",{className:"bg-neutral-800 p-6 rounded-2xl shadow-xl flex flex-col items-center gap-4 w-full max-w-md",children:[(0,r.jsxs)("label",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",className:"accent-green-500 scale-125",onChange:e=>b({...w,age:e.target.checked})}),(0,r.jsx)("span",{className:"text-sm",children:"I confirm that I am at least 18 years old"})]}),(0,r.jsxs)("label",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",className:"accent-green-500 scale-125",onChange:e=>b({...w,terms:e.target.checked})}),(0,r.jsx)("span",{className:"text-sm",children:"I agree to the Terms & Conditions and Privacy Policy"})]}),(0,r.jsx)(s,{className:"w-full bg-green-600 hover:bg-green-700 text-white font-semibold text-lg py-6 rounded-xl mt-4",disabled:!(w.age&&w.terms),onClick:()=>m.connect(),children:"Start Chatting"})]}),g&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-4 mt-4",children:[(0,r.jsx)("video",{ref:y,autoPlay:!0,muted:!0,className:"rounded-xl shadow-lg w-full md:w-96"}),(0,r.jsx)("video",{ref:R,autoPlay:!0,className:"rounded-xl shadow-lg w-full md:w-96"})]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-4 mt-4",children:[(0,r.jsx)(s,{onClick:()=>{var e;(null==(e=y.current)?void 0:e.srcObject)&&(y.current.srcObject.getAudioTracks().forEach(e=>e.enabled=!a),h(e=>!e))},variant:"outline",className:"rounded-xl",children:a?(0,r.jsx)(c.A,{}):(0,r.jsx)(l.A,{})}),(0,r.jsx)(s,{onClick:()=>{var a;(null==(a=y.current)?void 0:a.srcObject)&&(y.current.srcObject.getVideoTracks().forEach(t=>t.enabled=!e),t(e=>!e))},variant:"outline",className:"rounded-xl",children:e?(0,r.jsx)(i.A,{}):(0,r.jsx)(o.A,{})}),(0,r.jsx)(s,{onClick:()=>{if(f){O.current.stop(),p(!1);let e=new Blob(E.current,{type:"video/webm"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="recorded-chat.webm",a.click(),E.current=[]}else O.current=new MediaRecorder(y.current.srcObject),O.current.ondataavailable=e=>E.current.push(e.data),O.current.start(),p(!0)},variant:"outline",className:"rounded-xl",children:(0,r.jsx)(d.A,{className:f?"text-red-500":""})}),(0,r.jsx)(s,{onClick:()=>N(!0),variant:"outline",className:"rounded-xl",children:(0,r.jsx)(u.A,{})}),(0,r.jsx)(s,{onClick:()=>{T&&(m.emit("block-user",{partnerId:T}),A())},variant:"destructive",className:"rounded-xl",children:(0,r.jsx)(x.A,{})})]})]}),v&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:(0,r.jsxs)("div",{className:"bg-neutral-800 p-6 rounded-xl shadow-xl w-80 flex flex-col gap-4",children:[(0,r.jsx)("h2",{className:"text-lg font-bold",children:"Report User"}),(0,r.jsxs)("select",{value:k,onChange:e=>C(e.target.value),className:"bg-neutral-700 p-2 rounded",children:[(0,r.jsx)("option",{value:"",children:"Select reason"}),(0,r.jsx)("option",{value:"Inappropriate content",children:"Inappropriate content"}),(0,r.jsx)("option",{value:"Harassment",children:"Harassment"}),(0,r.jsx)("option",{value:"Spam or scam",children:"Spam or scam"}),(0,r.jsx)("option",{value:"Other",children:"Other"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(s,{className:"bg-red-600",onClick:()=>{k&&T&&(m.emit("report-user",{partnerId:T,reason:k}),A())},children:"Report"}),(0,r.jsx)(s,{variant:"outline",onClick:()=>N(!1),children:"Cancel"})]})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[669,636,593,792],()=>t(2936)),_N_E=e.O()}]);